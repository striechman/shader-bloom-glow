

## תיקון בעיית ייצוא באנרים - תמונות שחורות וקטנות

### הבעיה שזוהתה

לאחר בדיקה מעמיקה של הקוד, מצאתי מספר בעיות קריטיות בפונקציית Simplex Noise ב-JavaScript שגורמות לתמונות להיות שחורות:

1. **חישוב גרדיאנטים שגוי**: הפונקציה `calcGrad` לא תואמת את ה-GLSL המקורי - חסר חלק הקוד שמטפל ב-"sign flipping" (s0, s1, sh, a0, a1)

2. **קבוע סקלה שגוי**: ה-JS משתמש ב-`32.0` במקום `42.0` כמו ב-GLSL

3. **טיפול שגוי בגרדיאנטים**: הקוד ב-JS מנסה לחשב גרדיאנטים בודדים במקום וקטורים מקבילים כמו ב-GLSL

הבעיה העיקרית היא ש-`simplexNoise3D` מחזיר ערכים קרובים ל-0 כמעט תמיד, מה שגורם לכל הפיקסלים לקבל את הצבע הראשון בלבד (או שחור).

---

### הפתרון

#### אסטרטגיה: החלפה לאלגוריתם Simplex Noise תקין ובדוק

במקום לנסות לתרגם את ה-GLSL שורה-שורה (שזו משימה מורכבת מאוד), נשתמש ב-**אלגוריתם Simplex Noise פשוט ומוכח** שידוע שעובד ב-JavaScript.

#### קבצים לעריכה

| קובץ | שינוי |
|------|-------|
| `src/components/BannerPreview.tsx` | החלפת `simplexNoise3D` באלגוריתם עובד |
| `src/components/ExportModal.tsx` | החלפת `simplexNoise3D` באלגוריתם עובד |

#### שינויים טכניים

**1. החלפת פונקציית Simplex Noise**

נחליף את הפונקציה המורכבת באלגוריתם פשוט יותר שמבוסס על הגרסה הסטנדרטית של Simplex Noise:

```text
החלפה מלאה של simplexNoise3D ל:
- אלגוריתם Value Noise מבוסס hash פשוט
- או אלגוריתם Perlin Noise קלאסי שעובד בוודאות
- בדיקה שהערכים מוחזרים בטווח [-1, 1] בפועל
```

**2. הוספת לוג לדיבוג**

הוספת console.log זמני בתוך הפונקציה כדי לוודא שהערכים נכונים לפני הייצוא.

**3. בדיקת ערכי ברירת מחדל**

וידוא ש-`config.gradientColors`, `config.gradientWeights`, וכו' תמיד מוגדרים עם ערכי ברירת מחדל תקינים.

**4. הוספת fallback**

אם הרנדור נכשל, נוסיף fallback שיצייר לפחות גרדיאנט לינארי פשוט כדי שהתמונה לא תהיה שחורה.

---

### סיכום הפתרון

1. **החלפת simplexNoise3D** - אלגוריתם noise עובד ומוכח
2. **הוספת בדיקות null/undefined** - לכל הפרמטרים
3. **הוספת fallback** - גרדיאנט פשוט אם הרנדור נכשל
4. **בדיקת טווח ערכים** - וידוא ש-noise מחזיר ערכים בטווח [0,1]

